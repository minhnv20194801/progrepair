<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta content="text/html;charset=UTF-8" http-equiv="Content-Type"/>
    <link href="../jacoco-resources/report.css" rel="stylesheet" type="text/css"/>
    <link href="../jacoco-resources/report.gif" rel="shortcut icon" type="image/gif"/>
    <title>ShopTest.java</title>
    <link href="../jacoco-resources/prettify.css" rel="stylesheet" type="text/css"/>
    <script src="../jacoco-resources/prettify.js" type="text/javascript"></script>
</head>
<body onload="window['PR_TAB_WIDTH']=4;prettyPrint()">
<div class="breadcrumb" id="breadcrumb"><span class="info"><a class="el_session"
                                                              href="../jacoco-sessions.html">Sessions</a></span><a
        class="el_report" href="../index.html">JaCoCo Coverage Report</a> &gt; <a class="el_package"
                                                                                  href="index.source.html">default</a> &gt;
    <span class="el_source">ShopTest.java</span></div>
<h1>ShopTest.java</h1>
<pre class="source lang-java linenums">import org.junit.jupiter.api.BeforeEach;
import org.junit.jupiter.api.Test;

import java.util.ArrayList;
import java.util.List;

import static org.junit.jupiter.api.Assertions.*;

<span class="fc" id="L9">class ShopTest {</span>

    private Shop shop;
    private Customer alice;
    private Customer bob;

    @BeforeEach
    void setUp() {
<span class="fc" id="L17">        shop = createShopWithApple(5);</span>
<span class="fc" id="L18">        alice = new Customer(&quot;Alice&quot;, new BankAccount(100));</span>
<span class="fc" id="L19">        bob = new Customer(&quot;Bob&quot;, new BankAccount(100));</span>
<span class="fc" id="L20">    }</span>

    private Shop createShopWithApple(int qty) {
<span class="fc" id="L23">        Item apple = new Item(&quot;Apple&quot;, qty, 1.0);</span>
<span class="fc"
      id="L24">        return new Shop(new ArrayList&lt;&gt;(List.of(apple)), 2); // 2 carts for testing</span>
    }

    // ================== Item Tests ==================
    @Test
    void itemEdgeCases() {
<span class="fc" id="L30">        Item item = new Item(&quot;Orange&quot;, 0, 0.0);</span>
<span class="fc" id="L31">        assertEquals(0.0, item.getTotalPrice(), 0.0001);</span>

<span class="fc" id="L33">        Item negativePrice = new Item(&quot;Banana&quot;, 2, -5.0);</span>
<span class="fc" id="L34">        assertEquals(-10.0, negativePrice.getTotalPrice(), 0.0001);</span>

<span class="fc" id="L36">        Item zeroQty = new Item(&quot;Grapes&quot;, 0, 3.0);</span>
<span class="fc" id="L37">        assertEquals(0.0, zeroQty.getTotalPrice(), 0.0001);</span>
<span class="fc" id="L38">    }</span>

    // ================== ShoppingCart Edge Cases ==================
    @Test
    void shoppingCartMultipleItems() {
<span class="fc" id="L43">        ShoppingCart cart = new ShoppingCart();</span>
<span class="fc" id="L44">        Item apple = new Item(&quot;Apple&quot;, 2, 1.0);</span>
<span class="fc" id="L45">        Item banana = new Item(&quot;Banana&quot;, 3, 2.0);</span>

        // Add multiple items
<span class="fc" id="L48">        cart.addItem(apple);</span>
<span class="fc" id="L49">        cart.addItem(banana);</span>
<span class="fc" id="L50">        assertEquals(8.0, cart.getTotalPrice(), 0.0001);</span>

        // Remove some banana
<span class="fc" id="L53">        cart.removeItem(new Item(&quot;Banana&quot;, 2, 2.0));</span>
<span class="fc" id="L54">        assertEquals(4.0, cart.getTotalPrice(), 0.0001);</span>

        // Remove remaining banana
<span class="fc" id="L57">        cart.removeItem(new Item(&quot;Banana&quot;, 1, 2.0));</span>
<span class="fc" id="L58">        assertEquals(2.0, cart.getTotalPrice(), 0.0001);</span>
<span class="fc" id="L59">    }</span>

    @Test
    void shoppingCartRemoveNonExisting() {
<span class="fc" id="L63">        ShoppingCart cart = new ShoppingCart();</span>
<span class="fc" id="L64">        Item apple = new Item(&quot;Apple&quot;, 1, 1.0);</span>
<span class="fc" id="L65">        assertNull(cart.removeItem(apple));</span>
<span class="fc" id="L66">    }</span>

    // ================== Customer / VIP Logic ==================
    @Test
    void customerVIPThreshold() throws Exception {
<span class="fc" id="L71">        BankAccount shopAccount = new BankAccount();</span>

<span class="fc" id="L73">        Customer customer = new Customer(&quot;VIPTest&quot;, new BankAccount(200));</span>

        // Pay exactly 50 -&gt; not VIP
<span class="fc" id="L76">        customer.pay(50, shopAccount);</span>
<span class="fc" id="L77">        assertFalse(customer.isVIP());</span>

        // Pay 50.01 -&gt; VIP
<span class="fc" id="L80">        customer.pay(50.01, shopAccount);</span>
<span class="fc" id="L81">        assertTrue(customer.isVIP());</span>
<span class="fc" id="L82">    }</span>

    @Test
    void customerPayMultipleTimes() throws Exception {
<span class="fc" id="L86">        BankAccount shopAccount = new BankAccount();</span>
<span class="fc" id="L87">        Customer customer = new Customer(&quot;Alice&quot;, new BankAccount(200));</span>

<span class="fc" id="L89">        customer.pay(30, shopAccount);</span>
<span class="fc" id="L90">        assertFalse(customer.isVIP());</span>

<span class="fc" id="L92">        customer.pay(25, shopAccount);</span>
<span class="fc" id="L93">        assertFalse(customer.isVIP());</span>

<span class="fc" id="L95">        customer.pay(51, shopAccount);</span>
<span class="fc" id="L96">        assertTrue(customer.isVIP());</span>
<span class="fc" id="L97">    }</span>

    // ================== BankAccount Edge Cases ==================
    @Test
    void bankAccountZeroAndNegativeOperations() throws Exception {
<span class="fc" id="L102">        BankAccount account = new BankAccount();</span>
<span class="fc" id="L103">        BankAccount dest = new BankAccount();</span>

        // Transfer zero
<span class="fc" id="L106">        account.transferTo(0, dest);</span>
<span class="fc" id="L107">        assertEquals(0.0, account.getBalance());</span>
<span class="fc" id="L108">        assertEquals(0.0, dest.getBalance());</span>

        // Supply negative ignored
<span class="fc" id="L111">        account.supply(-100);</span>
<span class="fc" id="L112">        assertEquals(0.0, account.getBalance());</span>

        // Supply positive
<span class="fc" id="L115">        account.supply(100);</span>
<span class="fc" id="L116">        assertEquals(100.0, account.getBalance());</span>
<span class="fc" id="L117">    }</span>

    @Test
    void bankAccountMultipleTransfers() throws Exception {
<span class="fc" id="L121">        BankAccount source = new BankAccount(100);</span>
<span class="fc" id="L122">        BankAccount dest = new BankAccount(50);</span>

<span class="fc" id="L124">        source.transferTo(30, dest);</span>
<span class="fc" id="L125">        source.transferTo(20, dest);</span>
<span class="fc" id="L126">        assertEquals(50, source.getBalance(), 0.0001);</span>
<span class="fc" id="L127">        assertEquals(100, dest.getBalance(), 0.0001);</span>
<span class="fc" id="L128">    }</span>

    // ================== Shop Tests ==================
    @Test
    void shopMultipleCustomersAndCarts() throws Exception {
<span class="fc" id="L133">        shop.acceptCustomer(alice);</span>
<span class="fc" id="L134">        shop.acceptCustomer(bob);</span>

        // No more carts -&gt; exception
<span class="fc" id="L137">        Customer charlie = new Customer(&quot;Charlie&quot;, new BankAccount(100));</span>
<span class="pc"
      id="L138">        assertThrows(MaximumCustomerException.class, () -&gt; shop.acceptCustomer(charlie));</span>
<span class="fc" id="L139">    }</span>

    @Test
    void shopAddRemoveMultipleItems() throws Exception {
<span class="fc" id="L143">        shop.acceptCustomer(alice);</span>
<span class="fc" id="L144">        shop.acceptCustomer(bob);</span>

        // Add multiple items for alice
<span class="fc" id="L147">        shop.addItemToCustomerCart(alice, new Item(&quot;Apple&quot;, 2, 1.0));</span>
<span class="fc" id="L148">        shop.addItemToCustomerCart(alice, new Item(&quot;Apple&quot;, 1, 1.0)); // stock should decrease</span>

        // Add remaining stock for bob
<span class="fc" id="L151">        shop.addItemToCustomerCart(bob, new Item(&quot;Apple&quot;, 2, 1.0));</span>

        // No stock left -&gt; further addition fails silently
<span class="fc" id="L154">        assertDoesNotThrow(() -&gt; shop.addItemToCustomerCart(alice, new Item(&quot;Apple&quot;, 1, 1.0)));</span>
<span class="fc" id="L155">    }</span>

    @Test
    void shopCustomerPayingVIPUpdate() throws Exception {
<span class="fc" id="L159">        shop.acceptCustomer(alice);</span>

        // Add items worth &gt;50
<span class="fc" id="L162">        shop.reStock(new Item(&quot;Banana&quot;, 100, 2.0)); // add expensive items</span>
<span class="fc" id="L163">        shop.addItemToCustomerCart(alice, new Item(&quot;Banana&quot;, 30, 2.0)); // total = 60</span>

<span class="fc" id="L165">        shop.customerPaying(alice);</span>

<span class="fc" id="L167">        assertTrue(alice.isVIP());</span>
<span class="fc" id="L168">    }</span>

    @Test
    void shopReStockEdgeCases() {
        // Re-stock null
<span class="fc" id="L173">        assertDoesNotThrow(() -&gt; shop.reStock(null));</span>

        // Re-stock zero quantity
<span class="fc" id="L176">        shop.reStock(new Item(&quot;Apple&quot;, 0, 1.0));</span>
<span class="fc" id="L177">    }</span>

    @Test
    void shopRemoveItemFromStockFullAndPartial() throws Exception {
<span class="fc" id="L181">        shop.acceptCustomer(alice);</span>

        // Partial removal
<span class="fc" id="L184">        shop.addItemToCustomerCart(alice, new Item(&quot;Apple&quot;, 3, 1.0));</span>

        // Full removal
<span class="fc" id="L187">        Shop smallShop = createShopWithApple(2);</span>
<span class="fc" id="L188">        Customer bob2 = new Customer(&quot;Bob2&quot;, new BankAccount(100));</span>
<span class="fc" id="L189">        smallShop.acceptCustomer(bob2);</span>
<span class="fc" id="L190">        smallShop.addItemToCustomerCart(bob2, new Item(&quot;Apple&quot;, 2, 1.0));</span>
<span class="fc" id="L191">    }</span>

    @Test
    void shopMultipleAddRemoveClearSequences() throws Exception {
<span class="fc" id="L195">        shop.acceptCustomer(alice);</span>

        // Add and remove sequence
<span class="fc" id="L198">        shop.addItemToCustomerCart(alice, new Item(&quot;Apple&quot;, 2, 1.0));</span>
<span class="fc" id="L199">        shop.removeItemFromCustomerCart(alice, new Item(&quot;Apple&quot;, 1, 1.0));</span>
<span class="fc" id="L200">        shop.addItemToCustomerCart(alice, new Item(&quot;Apple&quot;, 1, 1.0));</span>

        // Pay and clear
<span class="fc" id="L203">        shop.customerPaying(alice);</span>

        // Free cart available again
<span class="fc" id="L206">        shop.acceptCustomer(bob);</span>
<span class="fc" id="L207">    }</span>

    @Test
    void shopAddItemNotEnoughStockDoesNothing() throws Exception {
<span class="fc" id="L211">        shop.acceptCustomer(alice);</span>

        // Request more than in stock
<span class="fc" id="L214">        shop.addItemToCustomerCart(alice, new Item(&quot;Apple&quot;, 10, 1.0)); // should not throw</span>
<span class="fc" id="L215">    }</span>

    @Test
    void payingUnregisteredCustomerThrows() {
<span class="fc" id="L219">        Shop shop = createShopWithApple(5);</span>
<span class="fc" id="L220">        Customer c = new Customer(&quot;Alice&quot;, new BankAccount(100));</span>

<span class="fc" id="L222">        assertThrows(UnregisteredCustomerException.class,</span>
<span class="nc" id="L223">                () -&gt; shop.customerPaying(c));</span>
<span class="fc" id="L224">    }</span>

    @Test
    void addItemUnregisteredCustomerThrows() {
<span class="fc" id="L228">        Shop shop = createShopWithApple(5);</span>
<span class="fc" id="L229">        Customer c = new Customer(&quot;Alice&quot;, new BankAccount(100));</span>

<span class="fc" id="L231">        assertThrows(UnregisteredCustomerException.class,</span>
<span class="nc"
      id="L232">                () -&gt; shop.addItemToCustomerCart(c, new Item(&quot;Apple&quot;, 2, 1.0)));</span>
<span class="fc" id="L233">    }</span>

    @Test
    void removeItemUnregisteredCustomerThrows() {
<span class="fc" id="L237">        Shop shop = createShopWithApple(5);</span>
<span class="fc" id="L238">        Customer c = new Customer(&quot;Alice&quot;, new BankAccount(100));</span>

<span class="fc" id="L240">        assertThrows(UnregisteredCustomerException.class,</span>
<span class="nc" id="L241">                () -&gt; shop.removeItemFromCustomerCart(c, new Item(&quot;Apple&quot;, 2, 1.0)));</span>
<span class="fc" id="L242">    }</span>

    @Test
    void transferToNegativeAmount() throws Exception {
<span class="fc" id="L246">        BankAccount source = new BankAccount(50);</span>
<span class="fc" id="L247">        BankAccount dest = new BankAccount(50);</span>

<span class="fc" id="L249">        source.transferTo(-30, dest);</span>

<span class="fc" id="L251">        assertEquals(50, source.getBalance(), 0.0001);</span>
<span class="fc" id="L252">        assertEquals(50, dest.getBalance(), 0.0001);</span>
<span class="fc" id="L253">    }</span>

    @Test
    void transferToMoreThanCurrentBalance() {
<span class="fc" id="L257">        BankAccount source = new BankAccount(50);</span>
<span class="fc" id="L258">        BankAccount dest = new BankAccount(50);</span>

<span class="pc"
      id="L260">        assertThrows(FailedTransactionException.class, () -&gt; source.transferTo(80, dest));</span>
<span class="fc" id="L261">    }</span>

    @Test
    void newBankAccountNegativeAmount() {
<span class="fc" id="L265">        BankAccount source = new BankAccount(-50);</span>
<span class="fc" id="L266">        assertEquals(0, source.getBalance(), 0.0001);</span>
<span class="fc" id="L267">    }</span>
}
</pre>
<div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.14.202510111229</span>
</div>
</body>
</html>